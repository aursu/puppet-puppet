# This file can be used to override the default puppet settings.
# See the following links for more details on what settings are available:
# - https://puppet.com/docs/puppet/5.5/config_important_settings.html
# - https://puppet.com/docs/puppet/5.5/config_about_settings.html
# - https://puppet.com/docs/puppet/5.5/config_file_main.html
# - https://puppet.com/docs/puppet/5.5/configuration.html
[main]
<% if @node_environment -%>
environment = <%= @node_environment %>
<% else -%>
environment = <%= @environment %>
<% end -%>
<% if @puppet_master -%>
strict = <%= @strict %>
<%   if @basemodulepath -%>
basemodulepath = <%= @basemodulepath %>
<%   elsif @use_common_env -%>
basemodulepath = <%= [@environmentpath, @common_envname, 'modules'].join('/') %>
<%   end -%>
<%   if @dns_alt_names.is_a?(Array) -%>
dns_alt_names = <%= @dns_alt_names.join(',') %>
<%   end -%>
<%   if @strict_variables -%>
<%# Default: false -%>
strict_variables = true
<%   end -%>
<% end -%>

[agent]
server = <%= @server %>
http_read_timeout = <%= @http_read_timeout %>
<% if @ca_server -%>
ca_server = <%= @ca_server %>
<% end -%>
<% unless @daemonize -%>
<%# Default: true -%>
daemonize = false
<% end -%>
<% if @onetime -%>
<%# Default: false -%>
onetime = true
<% end -%>
<% if @runtimeout -%>
runtimeout = <%= @runtimeout %>
<% end -%>
<% if @priopity -%>
priority = <%= @priority %>
<% end -%>
<% unless @usecacheonfailure -%>
<%# Default: true -%>
usecacheonfailure = false
<% end -%>

<% if @puppet_master -%>
[master]
vardir = /opt/puppetlabs/server/data/puppetserver
logdir = /var/log/puppetlabs/puppetserver
rundir = /var/run/puppetlabs/puppetserver
pidfile = /var/run/puppetlabs/puppetserver/puppetserver.pid
codedir = /etc/puppetlabs/code

environment_timeout = <%= @environment_timeout %>
<% if @allow_duplicate_certs -%>
<%# Default: false -%>
allow_duplicate_certs = true
<% end -%>
<% unless @sameca -%>
<%# Default: true -%>
ca = false
<% end -%>
<% if @use_enc -%>
# ENC
node_terminus = exec
external_nodes = <%= @external_nodes %>
<% end -%>
<% if @use_puppetdb -%>
storeconfigs = true
storeconfigs_backend = puppetdb
report = true
reports = puppetdb
<% end -%>
<% end -%>